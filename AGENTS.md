# AGENTS Instructions

This repository contains a small web application for calculating Helldivers 2 stratagem and rocket cooldowns.

The app has been migrated to SvelteKit to simplify structure and improve maintainability/testability while keeping the codebase small and approachable.

## Structure
- `svelte/`: SvelteKit app (TypeScript + Tailwind). This is the UI and app runtime.
  - `src/lib/`: Shared modules.
    - `components/`:
      - `ErrorPage.svelte`: Single source of truth for error/404 UI used by both dev/preview and static 404.
    - `data/`: JSON data imported statically.
    - `rockets/`, `stratagems/`, `upgrades/`: Pure logic and helpers.
    - `stores/`: Svelte stores and persistence utilities.
      - `global.ts`: Global mission options (e.g., `orbitalFluctuations`) shared across pages.
  - `src/routes/`:
    - `+layout.svelte`: Global layout and header/footer. Hides header on error pages and `/404`.
    - `+error.svelte`: Renders `ErrorPage` for SSR 4xx/5xx in dev/preview.
    - `404/+page.svelte` and `404/+page.ts`: Renders `ErrorPage` and prerenders to `build/404.html`; `csr = false` to avoid re-hydration changing layout on Cloudflare.
    - `stratagems/`, `rockets/`: Main pages.
  - `static/`: Static assets served at root (e.g., `/images/...`).
- `tests/`: Node `--test` suites for pure logic (rockets, upgrades).
- Root `package.json`: test runner and convenience scripts for building/running the Svelte app.

Legacy directories (`js/`, `css/`, `data/`, `index.html`) are removed as part of the migration.

## Running the App
- Development server:
  - From repo root: `npm run dev`
  - This runs `vite dev` in `svelte/` with hot reload.
- Production build:
  - From repo root: `npm run build`
  - Output is a static site generated by `@sveltejs/adapter-static` in `svelte/build/`.
  - Preview production build:
  - From repo root: `npm run preview`

### 404 Behavior (Cloudflare / Wrangler)
- Cloudflare static hosting serves `svelte/build/404.html` for unknown paths. We generate that via a real `/404` route that is prerendered and has `csr = false`.
- SvelteKit dev/preview uses `+error.svelte` automatically for unknown routes; it shares UI with `/404` by importing `ErrorPage.svelte`.
- `svelte/svelte.config.js` sets `paths.relative = false` so that 404 asset URLs are absolute and work from any nested path.

## Testing
- Ensure Node 20+ is installed.
- Run logic tests and build to check for errors:
  ```bash
  npm test
  npm run build
  ```
  Tests import TypeScript directly using `tsx`, and validate pure functions in `svelte/src/lib`.

## Development Notes
- TypeScript is used to keep functions typed and readable.
- Tailwind keeps styles simple; prefer utility classes, fall back to component styles as needed.
- Data is imported statically (no runtime fetch) for a fully static build.
- If structural changes are made, update this document accordingly.
